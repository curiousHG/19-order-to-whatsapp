{
  "$schema": "https://schema.railpack.com",
  "steps": {
    "install": {
      "commands": [
        "python -m venv /app/.venv",
        "/app/.venv/bin/pip install --upgrade pip",
        "/app/.venv/bin/pip install -r requirements.txt",
        "npm install --prefix frontend"
      ]
    },
    "build": {
      "inputs": [{ "step": "install" }],
      "commands": [
        "npm run build --prefix frontend",
        "python manage.py collectstatic --noinput"
      ]
    }
  },
  "deploy": {
    "base": {
      "image": "ghcr.io/railwayapp/railpack-runtime:latest"
    },
    "inputs": [
      {
        "step": "build",
        "include": [
          "/app/.venv",
          "/app/core",
          "/app/store",
          "/app/frontend/dist",
          "/app/manage.py",
          "/app/requirements.txt",
          "/app/staticfiles",
          "/app/core/wsgi.py"
        ]
      }
    ],
    "startCommand": "/app/.venv/bin/python manage.py migrate && /app/.venv/bin/gunicorn core.wsgi:application --bind 0.0.0.0:8080"
  }
}
